"use strict";var Util={elementStyle:document.createElement("div").style,vendor:function(){var d=["t","webkitT","MozT","msT","OT"],b,c=0,a=d.length;for(;
c<a;c++){b=d[c]+"ransform";if(b in Util.elementStyle){return d[c].substr(0,d[c].length-1);}}return false;},prefixStyle:function(a){if(Util.vendor()===false){return false;
}if(Util.vendor()===""){return a;}return Util.vendor()+a.charAt(0).toUpperCase()+a.substr(1);},hasPerspective:function(){var a=Util.prefixStyle("perspective") in Util.elementStyle;
if(a&&"webkitPerspective" in Util.elementStyle){Util.injectStyles("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=b.offsetLeft===9&&b.offsetHeight===3;
});}return !!a;},translateZ:function(){if(Util.hasPerspective){return" translateZ(0)";}else{return"";}}};var defaults={contentEl:"#J_content",isRefresh:true,isLoadingMore:true,movePosition:null,distanceToRefresh:100,minDistanceToRefresh:100,maxDistanceToRefresh:200,interval:5,refreshCallback:function(){},loadingMoreCallback:function(){}};
var viewHeight=$(window).height();function Refresh(b,a){this.$wrap=b;this.opts=$.extend(true,{},defaults,a||{});this.$content=$(this.opts.contentEl);this.startY=0;
this.refreshHeight=0;this.isPullToRefresh=false;this.isLoading=false;this.finished=false;this.wrapHeight=this.$content.height();this.oldScrollTop=0;this.loadingFinishTime=new Date().getTime();
this.scrollTop=this.$content.scrollTop();this.init();}Refresh.prototype.init=function(){this.loadingRender();this.bind();this.reBindScroll();};Refresh.prototype.loadingRender=function(){var b=this;
var a=["<style>",".preloader-refresh {position: absolute;top: -50px;left: 0;right: 0;width: 100%;text-align: center;padding: 5px 0;}",".preloader-refresh .icon-refresh {display: inline-block;width: 40px;height: 40px; background: url(css/i/pull-icon@2x.png) no-repeat 0 0;background-size: 40px 80px;-webkit-transition-property:-webkit-transform;-webkit-transition-duration:250ms;-webkit-transform:rotate(0deg) translateZ(0);}",".preloader-refresh-flip .icon-refresh {-webkit-transform:rotate(-180deg) translateZ(0);}",".preloader-refresh-loading .icon-refresh {background-position:0 100%;-webkit-transform:rotate(0deg) translateZ(0);-webkit-transition-duration:0ms;-webkit-animation-name:refreshLoading;-webkit-animation-duration:2s;-webkit-animation-iteration-count:infinite;-webkit-animation-timing-function:linear;}","@-webkit-keyframes refreshLoading {","from { -webkit-transform:rotate(0deg) translateZ(0); }","to { -webkit-transform:rotate(360deg) translateZ(0); }","}","</style>",'<div class="preloader-refresh">','<i class="icon-refresh"></i>',"</div>"].join("");
var c=["<style>",".preloader-loading-more {display: block;padding: 15px 10px;text-align:center;}",'.preloader-loading-more:before,.preloader-loading-more:after {content:""}',".preloader-loading-more .loading-bounce, .preloader-loading-more:before, .preloader-loading-more:after {width: 15px;height: 15px;background-color: #dd0202;-webkit-border-radius: 100%;border-radius: 100%;display: inline-block; -webkit-animation: bouncedelay 1.4s infinite ease-in-out;animation: bouncedelay 1.4s infinite ease-in-out; -webkit-animation-fill-mode: both;animation-fill-mode: both;}",".preloader-loading-more:before {-webkit-animation-delay: -0.32s;animation-delay: -0.32s;}",".preloader-loading-more .loading-bounce {-webkit-animation-delay: -0.16s;animation-delay: -0.16s;}","@-webkit-keyframes bouncedelay {","0%, 80%, 100% { -webkit-transform: scale(0.0) }","40% { -webkit-transform: scale(1.0) }","}","@keyframes bouncedelay {","0%, 80%, 100% {","transform: scale(0.0);","} 40% {","transform: scale(1.0);","}","}","</style>",'<div class="preloader-loading-more">','<span class="loading-bounce"></span>',"</div>"].join("");
if(this.opts.isRefresh){this.$content.before(a);this.$pullToRefresh=$(".preloader-refresh");this.refreshHeight=this.$pullToRefresh.height();}if(this.opts.isLoadingMore){this.$content.after(c);
this.$loadingMore=$(".preloader-loading-more");if(this.wrapHeight<viewHeight){this.$loadingMore.hide();}}};Refresh.prototype.bind=function(){var a=this;
if(this.opts.isRefresh){this.$wrap.on("touchstart",function(b){a.startX=b.originalEvent.targetTouches[0].pageX;a.startY=b.originalEvent.targetTouches[0].pageY;
}).on("touchmove",function(b){a.scrollTop=$(this).scrollTop();a.touchMove(b,$(this));}).on("touchend",function(b){a.touchEnd(b);});}};Refresh.prototype.reBindScroll=function(){var a=this,b=null;
this.$wrap.off("scroll.refresh").on("scroll.refresh",function(){b=setTimeout(function(){a.getLoadMore();},300);});};Refresh.prototype.touchMove=function(f,c){var d=$(f.target);
if(!d.parents(this.opts.contentEl).size()){return;}var b=f.originalEvent.targetTouches[0].pageX-this.startX,a=f.originalEvent.targetTouches[0].pageY-this.startY;
if(Math.abs(b)>Math.abs(a)){this.isPullToRefresh=false;this.$content[0].style[Util.prefixStyle("transform")]="translate(0, 0)"+Util.translateZ();this.$pullToRefresh[0].style[Util.prefixStyle("transform")]="translate(0, 0)"+Util.translateZ();
return;}if(a>0){this.opts.movePosition="down";}else{this.opts.movePosition="up";}var g=a;g=g<this.opts.maxDistanceToRefresh?g:this.opts.maxDistanceToRefresh;
g=Math.sin(g/this.opts.maxDistanceToRefresh)*g;if(this.scrollTop<=this.opts.distanceToRefresh&&this.opts.movePosition==="down"){if(a>=this.opts.minDistanceToRefresh){this.$pullToRefresh.addClass("preloader-refresh-flip");
this.isPullToRefresh=true;}else{this.$pullToRefresh.removeClass("preloader-refresh-flip");this.isPullToRefresh=false;}this.$content[0].style[Util.prefixStyle("transform")]="translate(0,"+g+"px)"+Util.translateZ();
this.$pullToRefresh[0].style[Util.prefixStyle("transform")]="translate(0,"+g+"px)"+Util.translateZ();f.preventDefault();return;}this.isPullToRefresh=false;
};Refresh.prototype.touchEnd=function(d){var c=this;function a(){c.$pullToRefresh.removeClass("preloader-refresh-loading");c.wrapHeight=c.$content.height();
c.$content[0].style[Util.prefixStyle("transition")]="all .3s";c.$content[0].style[Util.prefixStyle("transform")]="translate(0, 0)"+Util.translateZ();c.$pullToRefresh[0].style[Util.prefixStyle("transition")]="all .3s";
c.$pullToRefresh[0].style[Util.prefixStyle("transform")]="translate(0, 0)"+Util.translateZ();if(c.finished){c.finished=false;c.reBindScroll();}g();}function g(){setTimeout(function(){c.$content[0].style[Util.prefixStyle("transition")]="";
c.$pullToRefresh[0].style[Util.prefixStyle("transition")]="";},500);}g();var b=new Date().getTime();if(this.opts.interval&&b-this.loadingFinishTime<this.opts.interval){a();
return;}this.loadingFinishTime=b;var f=0;if(this.isPullToRefresh){f=this.refreshHeight;}this.$content[0].style[Util.prefixStyle("transition")]="all .3s";
this.$content[0].style[Util.prefixStyle("transform")]="translate(0, "+f+"px)"+Util.translateZ();this.$pullToRefresh[0].style[Util.prefixStyle("transition")]="all .3s";
this.$pullToRefresh[0].style[Util.prefixStyle("transform")]="translate(0,"+f+"px)"+Util.translateZ();if(this.isPullToRefresh){this.$pullToRefresh.removeClass("preloader-refresh-flip").addClass("preloader-refresh-loading");
this.opts.refreshCallback&&this.opts.refreshCallback(a);this.isPullToRefresh=false;}};Refresh.prototype.getLoadMore=function(){var e=this;if(this.finished){return;
}var f=this.$wrap.scrollTop(),a=viewHeight+f,c=null;function b(g){if("finish"==g){e.finished=true;e.$loadingMore.hide();e.$wrap.off("scroll.refresh");}e.isLoading=false;
e.wrapHeight=e.$content.height();}if(this.wrapHeight<=a+10&&this.oldScrollTop<f&&!this.isLoading&&this.opts.isLoadingMore){var d=new Date().getTime();if(this.opts.interval&&d-this.loadingFinishTime<this.opts.interval){return;
}this.loadingFinishTime=d;this.$loadingMore.show();this.isLoading=true;this.opts.loadingMoreCallback&&this.opts.loadingMoreCallback(b);}this.oldScrollTop=f;
};$.fn.refresh=function(a,b){return this.each(function(){new Refresh($(this),a);});};